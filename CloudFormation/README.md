# Audio Transcription and Summary Workflow

This repository contains the AWS CloudFormation template for deploying an automated audio transcription and summarization workflow. When an audio file is uploaded to a designated S3 bucket, it triggers a series of AWS services to transcribe the audio and then generate a summary of the transcribed text.

## Architecture

The workflow consists of the following components:

1.  **Input Audio S3 Bucket (`InputAudioBucketName`):** This is where you upload your audio files (e.g., `.mp3`, `.wav`).
2.  **SQS Queue (`SQSQueue`):** An SQS queue that receives notifications when new audio files are created in the input bucket.
3.  **Data to Transcribe Lambda Function (`DataToTranscribeLambda`):** This Lambda function is triggered by messages in the SQS queue. It retrieves the audio file from the input bucket and initiates an AWS Transcribe job.
4.  **Transcribe Output S3 Bucket (`TranscribeOutputBucketName`):** This bucket stores the transcription results from AWS Transcribe.
5.  **Transcribe to Bedrock Lambda Function (`TranscribeToBedrockLambda`):** This Lambda function is triggered when a new transcription is available in the transcribe output bucket. It retrieves the transcribed text and uses Amazon Bedrock to generate a summary.
6.  **Summary Output S3 Bucket (`SummaryOutputBucketName`):** This bucket stores the final summary generated by Amazon Bedrock.

## Parameters

The CloudFormation template uses the following parameters, which you can customize during deployment:

* **`InputAudioBucketName`:** The name of the S3 bucket where you will upload the audio files.
    * Type: `String`
    * Default: `input-audio-123456789-987654321`
* **`TranscribeOutputBucketName`:** The name of the S3 bucket where the transcription results will be stored.
    * Type: `String`
    * Default: `transcribe-output-123456789-987654321`
* **`SummaryOutputBucketName`:** The name of the S3 bucket where the final summaries will be stored.
    * Type: `String`
    * Default: `finished-result-of-audio-123456789-987654321`

## Resources

The CloudFormation template defines the following AWS resources:

* **`SQSQueue`:** An SQS queue named `sqs-to-lambda` with a message retention period of 4 days (345600 seconds) and a visibility timeout of 2 minutes (120 seconds).
* **`DataToTranscribeRole`:** An IAM role that grants the `DataToTranscribeLambda` function the necessary permissions to:
    * Write logs to CloudWatch.
    * Read objects from the `InputAudioBucket`.
    * Start AWS Transcribe jobs.
    * Write objects to the `TranscribeOutputBucket`.
    * Send and receive messages from the `SQSQueue`.
* **`TranscribeToBedrockRole`:** An IAM role that grants the `TranscribeToBedrockLambda` function the necessary permissions to:
    * Write logs to CloudWatch.
    * Read objects from the `TranscribeOutputBucket`.
    * Invoke Amazon Bedrock models.
    * Write objects to the `SummaryOutputBucket`.
* **`DataToTranscribeLambda`:** A Lambda function named `sqs-to-transcribe` that runs on Python 3.9. The handler is `lambda_function.lambda_handler`. The code for this function is expected to be in an S3 bucket named `bucket-for-lambda-code-123456789-987654321` with the key `transcribe.zip`. It has a timeout of 60 seconds and 128MB of memory.
* **`TranscribeToBedrockLambda`:** A Lambda function named `transcribe-to-bedrock` that runs on Python 3.9. The handler is `lambda_function.lambda_handler`. The code for this function is expected to be in an S3 bucket named `bucket-for-lambda-code-123456789-987654321` with the key `summarize.zip`. It has a timeout of 300 seconds and 128MB of memory.
* **`InputAudioBucket`:** An S3 bucket created with the name provided in the `InputAudioBucketName` parameter. It is configured to send notifications to the `SQSQueue` whenever a new object is created. Public access is not blocked for this bucket.
* **`TranscribeOutputBucket`:** An S3 bucket created with the name provided in the `TranscribeOutputBucketName` parameter. It is configured to trigger the `TranscribeToBedrockLambda` function when a new object is created.
* **`SummaryOutputBucket`:** An S3 bucket created with the name provided in the `SummaryOutputBucketName` parameter.
* **`SQSEventSourceMapping`:** Configures the `DataToTranscribeLambda` function to be triggered by messages in the `SQSQueue`, with a batch size of 10.
* **`DataToTranscribeLambdaPermission`:** Grants SQS permission to invoke the `DataToTranscribeLambda` function.
* **`SQSQueuePolicy`:** Grants the `InputAudioBucket` permission to send messages to the `SQSQueue` when new objects are created.
* **`TranscribeToBedrockLambdaPermission`:** Grants the `TranscribeOutputBucket` permission to invoke the `TranscribeToBedrockLambda` function when new objects are created.

## Outputs

The CloudFormation template outputs the following values after successful deployment:

* **`InputAudioBucketName`:** The name of the input audio bucket.
* **`TranscribeOutputBucketName`:** The name of the transcribe output bucket.
* **`SummaryOutputBucketName`:** The name of the summary output bucket.
* **`SQSQueueURL`:** The URL of the SQS queue.
* **`DataToTranscribeLambdaArn`:** The ARN of the Data to Transcribe Lambda function.
* **`TranscribeToBedrockLambdaArn`:** The ARN of the Transcribe to Bedrock Lambda function.

## Deployment

To deploy this workflow, you will need to:

1.  **Package Lambda Functions:** Create ZIP files containing the code for the `DataToTranscribeLambda` and `TranscribeToBedrockLambda` functions.
2.  **Upload Lambda Packages to S3:** Upload the ZIP files to the S3 bucket specified by `bucket-for-lambda-code-123456789-987654321` with the keys `transcribe.zip` and `summarize.zip` respectively. **Remember to replace this bucket name with your actual bucket name.**
3.  **Deploy the CloudFormation Template:** Use the AWS Management Console, AWS CLI, or other infrastructure-as-code tools to deploy this `template.yaml` file. You will be prompted to enter the desired names for the input, transcribe output, and summary output S3 buckets.

## Usage

1.  Once the CloudFormation stack is successfully deployed, upload your audio files to the S3 bucket specified by the `InputAudioBucketName` output.
2.  The workflow will automatically trigger:
    * The `DataToTranscribeLambda` function will initiate an AWS Transcribe job for each new audio file.
    * Upon completion of the transcription, the `TranscribeToBedrockLambda` function will be triggered.
    * The transcription will be summarized using Amazon Bedrock.
    * The final summary will be stored in the S3 bucket specified by the `SummaryOutputBucketName` output.

## Important Notes

* Ensure that the S3 bucket (`bucket-for-lambda-code-123456789-987654321`) containing the Lambda function code is in the same AWS region where you are deploying the CloudFormation stack.
* You will need to have appropriate permissions configured in your AWS account to create and manage these resources.
* The cost of this workflow will depend on the usage of AWS S3, SQS, Transcribe, Lambda, and Bedrock.
* The specific Bedrock model used for summarization is not defined in this template and would be part of the `TranscribeToBedrockLambda` function's code. You may need to adjust the IAM role (`TranscribeToBedrockRole`) if you intend to use specific Bedrock models that require additional permissions.
